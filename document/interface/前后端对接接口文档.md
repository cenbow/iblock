<!-- MarkdownTOC -->

- [1 概述](#1-概述)
- [2 接口约定](#2-接口约定)
  - [2.1 统一响应模型](#21-统一响应模型)
  - [2.2 分页请求](#22-分页请求)
  - [2.3 分页响应](#23-分页响应)
- [3 数据模型](#3-数据模型)
  - [3.1 枚举](#31-枚举)
- [4 接口定义](#4-接口定义)
  - [4.1 登录](#41-登录)
  - [4.2 验证手机号](#42-验证手机号)
  - [4.3 注册 \(不自动登录\)](#43-注册-不自动登录)
  - [4.4 个人信息](#44-个人信息)
    - [4.4.1 获取个人信息](#441-获取个人信息)
    - [4.4.2 更新个人信息](#442-更新个人信息)
    - [4.4.3 获取工作经验\(仅限设计师\)](#443-获取工作经验仅限设计师)
    - [4.4.4 添加工作经验](#444-添加工作经验)
    - [4.4.4.1 更新工作经验](#4441-更新工作经验)
    - [4.4.5 删除工作经验](#445-删除工作经验)
    - [4.4.6 获取工作兴趣](#446-获取工作兴趣)
    - [4.4.7 更新工作兴趣](#447-更新工作兴趣)
    - [4.4.8 获取技能](#448-获取技能)
    - [4.4.7 获取用户头像\(TBD\)](#447-获取用户头像tbd)
    - [4.4.8 上传用户头像\(TBD\)](#448-上传用户头像tbd)
    - [4.4.9 添加共同经历](#449-添加共同经历)
    - [4.4.10 接受添加共同经历](#4410-接受添加共同经历)
    - [4.4.11 上传个人作品 TBD](#4411-上传个人作品-tbd)
  - [4.5 个人账户](#45-个人账户)
    - [4.5.1 获取我的账户余额](#451-获取我的账户余额)
    - [4.5.2 获取我的账户明细](#452-获取我的账户明细)
    - [4.5.3 申请提现](#453-申请提现)
    - [4.5.4 完成提现](#454-完成提现)
  - [4.6 项目列表](#46-项目列表)
    - [4.6.1 获取项目搜索列表](#461-获取项目搜索列表)
    - [4.6.2 获取推荐项目列表\(根据用户填写的偏好进行搜索推荐\)](#462-获取推荐项目列表根据用户填写的偏好进行搜索推荐)
    - [4.6.3 获取最新项目列表\(正在招募的项目时间倒序\)](#463-获取最新项目列表正在招募的项目时间倒序)
  - [4.7 设计师列表](#47-设计师列表)
    - [4.7.1 设计师搜索](#471-设计师搜索)
    - [4.7.2 推荐设计师\(根据项目经理手中进行项目的条件进行搜索匹配\)](#472-推荐设计师根据项目经理手中进行项目的条件进行搜索匹配)
    - [4.7.3 热门设计师\(按照评分倒序\)](#473-热门设计师按照评分倒序)
  - [4.8 项目管理](#48-项目管理)
    - [4.8.1 项目创建](#481-项目创建)
    - [4.8.2 项目审核](#482-项目审核)
    - [4.8.3 项目重新提交](#483-项目重新提交)
    - [4.8.4 项目招人](#484-项目招人)
    - [4.8.5   设计师接受招募](#485---设计师接受招募)
    - [4.8.6 项目经理确认招募完成](#486-项目经理确认招募完成)
    - [4.8.7 项目经理启动项目](#487-项目经理启动项目)
    - [4.8.8 项目经理收尾项目](#488-项目经理收尾项目)
    - [4.8.9 项目经理对设计师评分,或设计师对项目经理评分](#489-项目经理对设计师评分或设计师对项目经理评分)
    - [4.8.10 管理员终止项目](#4810-管理员终止项目)
    - [4.8.11 项目修改（项目开始前可以对项目进行修改）](#4811-项目修改（项目开始前可以对项目进行修改）)
    - [4.8.12 获取项目详情](#4812-获取项目详情)
  - [4.9 阶段管理](#49-阶段管理)
    - [4.9.1 添加阶段](#491-添加阶段)
    - [4.9.2 修改阶段](#492-修改阶段)
    - [4.9.3 删除阶段](#493-删除阶段)
    - [4.9.4 获取项目阶段信息](#494-获取项目阶段信息)
    - [4.9.5 阶段招募完成](#495-阶段招募完成)
    - [4.9.6 阶段收尾](#496-阶段收尾)
    - [4.9.7 阶段验收](#497-阶段验收)
  - [4.10 招募管理](#410-招募管理)
    - [4.10.1 添加招募职位](#4101-添加招募职位)
    - [4.10.2 修改招募职位](#4102-修改招募职位)
    - [4.10.3 删除招募职位](#4103-删除招募职位)
    - [4.10.4 雇佣人员](#4104-雇佣人员)
    - [4.10.5 申请解除合约](#4105-申请解除合约)
    - [4.10.6 同意解除合约](#4106-同意解除合约)
    - [4.10.7 推荐设计师](#4107-推荐设计师)
    - [4.10.8 获取推荐设计师列表](#4108-获取推荐设计师列表)
  - [4.11 系统消息](#411-系统消息)
    - [4.11.1 获取消息](#4111-获取消息)
    - [4.11.2 消息操作 - 任务](#4112-消息操作---任务)
    - [4.11.3 消息操作 - 读或处理](#4113-消息操作---读或处理)
  - [4.12 用户安全信息](#412-用户安全信息)
    - [4.12.1 修改用户手机号](#4121-修改用户手机号)
    - [4.12.2 修改密码](#4122-修改密码)

<!-- /MarkdownTOC -->


# 1 概述

本文档是针对IBLOCK前后端HTTP接口的说明文档，包括接口约定、数据模型和接口定义等，前后端互相传输的参数统一用JSON格式。 

# 2 接口约定

## 2.1 统一响应模型

名称：response

```json
{
  "status": 0, // 0代表成功，其他状态码后续结合具体业务再定
  "msg": "", // 状态详情
  "data": { // 具体数据，可以为空
      // 数据结构与具体业务相关，参考下面[数据模型]定义
    }
  } 
}
```

## 2.2 分页请求

名称：pageRequest

```json
{
  "pageNo": 1, // 必填，从1开始
  "pageSize": 20, // 必填
  "order": "asc", 
  "orderBy": "updateTime"
}
```

## 2.3 分页响应

名称：pageResponse

```
{
  "status": 0, // 0代表成功，其他状态码后续结合具体业务再定
  "msg": "", // 状态详情
  "data": {
    "pageNo": 1, // 必有
    "pageSize": 20, // 必有
    "order": "asc",
    "orderBy": "updateTime",
    "totalCount":100 // 必有
    "result":[]  // 数据结构与具体业务相关，参考下面[数据模型]定义
    }
  } 
}
```

# 3 数据模型

为方便描述，下面定义各业务涉及的数据模型，接口描述中涉及到数据模型时用${模型名}来指代。

## 3.1 枚举
|枚举名|枚举值|说明|
|:-:|:-:|:-:|
|ResponseStatus|0成功执行 404未找到资源 500系统错误 501外部接口错误 403没有权限 415参数错误 501 校验错误|响应状态|
|UserRole|1经纪人 2设计师 3项目经理 4系统管理员|用户类型|
|UserStatus|1隐身 2 在线 3 冻结 4 忙碌? |用户状态|

# 4 接口定义

## 4.1 登录 

|**URI**|user/logon|
|:-:|:-:|
|**Method**| POST|
|**Role**| 1 2 3 4 |

Request-header

```
{
	"username":""
	"passwd":""
}
```

Response

```
{
	"status":""
	"msg":""
}
```
## 4.2 验证手机号

|**URI**|/user/sendValidateCode/|
|:-:|:-:|
|**Method**| POST|
|**Role**| 1|

Request 1:

```
{
	"phone":"187129892"
}

```
Response 2:

```
{
  "status": 0, // 0代表成功，其他状态码后续结合具体业务再定
  "msg": "", // 状态详情

}
```

## 4.3 注册 (不自动登录)
|**URI**|user/signup|
|:-:|:-:|
|**Method**| POST|
|**Role**| 1 2 3 4 |

Request （设计师)

```json
{
	"username":""
	"passwd":"",
	"contactPhone":"",
	"verifyCode":"",//手机验证码
	"geo": {
      "province":"上海市",
      "city":"上海市",
      "district": "杨浦区",
      "address": "五角场XX路XX号"
    }
}
```

Request （项目经理)

```json
{
	"username":""
	"passwd":"",
	"contactPhone":"",
	"verifyCode":"",//手机验证码
	"geo": {
      "province":"上海市",
      "city":"上海市"
   },
   "corporateName":"设计有限公司",//
   "corporateBio":"公司简介"//

}
```

Response

```json
{
	"status":"",
	"errorMsg":""
}
```


## 4.4 个人信息 


### 4.4.1 获取个人信息

|**URI**| user/info/{userid}|
|:-:|:-:|
|**Method**| GET|
|**Role**| 1 2 3 4 |

```json
{
  "status": 0, 
  "msg": "", 
  "data": {
    "userid": 1, 
    "username": "贾翕",
    "rating": 6,
    "education": 2,
    "status":0,
    "role":2,
    "contactPhone":"13311625852",
    "geo":{
    	"province":1,
    	"city":1,	
    	"street":"杨浦市区五角场街道"
    },
    "skills":[],
    "avatar":"/img/jesse.jpg"
	}
}
```




### 4.4.2 更新个人信息

|**URI**| user/updateUserInfo|
|:-:|:-:|
|**Method**| POST|
|**Role**| 1 2 3 4 |

```json
{
  "status": "1", //更新状态，隐身、在线
  "education": {"id":1,"name":"sdjfd"}// 2  更新学历
  "geo": {//更新地理位置
    "province":{"id":1,"name":"kx"},
    "city":{"id":1,"name":"ld"},
    "district":{"id":1,"name":"dfs"},
    "address": "五角场XX路XX号"
  },
  "corporateName":"设计有限公司",// 3 only 更新公司资料
  "corporateBio":"公司简介"//3 only 更新公司资料
  "skills":[{"id":1,"name":"jineng"},{"id":2,"name":"jineng"}]
  
  }
}
```

Return: 

```json
{
  "status": 0, // 0代表成功
  "msg": "", // 状态详情
}
```



### 4.4.3 获取工作经验(仅限设计师)
|**URI**| user/getWorkExperience/{userid}|
|:-:|:-:|
|**Method**| GET|
|**Role**| 1 2 3 4 |
```
{
  "status": 0, // 0代表成功，其他状态码后续结合具体业务再定
  "msg": "", // 状态详情
  "data": {
    "expirience":[{
      "id": 123,
      "industry":{"id":1,"name":"df"}
      "time": 2,
      "desc" "担任设计师职位"
    },...]
  }
}
```

### 4.4.4 添加工作经验
|**URI**| user/addWorkExperience|
|:-:|:-:|
|**Method**| POST|
|**Role**| 2|
```
{
"time":"1",
"industry":{"id":2,"name":"建筑设计"},
"desc":"fdfdsfsdf"}
```

### 4.4.4.1 更新工作经验
|**URI**| user/updateWorkExperience|
|:-:|:-:|
|**Method**| POST|
|**Role**| 2|
```
{
"id":1,
"time":"1",
"industry":{"id":2,"name":"建筑设计"},
"desc":"fdfdsfsdf"
}
```

Return: 和4.4.3一样

### 4.4.5 删除工作经验
|**URI**| user/deleteWorkExperience|
|:-:|:-:|
|**Method**| POST|
|**Role**| 2|
```
{
  "id": 123
}
```
Return: 

```
{
  "status": 0, // 0代表成功
  "msg": "", // 状态详情
}
```



### 4.4.6 获取工作兴趣
|**URI**| user/getWorkPrefs/{userid}|
|:-:|:-:|
|**Method**| GET|
|**Role**| 2|

```
{
  "status": 0, // 0代表成功，其他状态码后续结合具体业务再定
  "msg": "", // 状态详情
  "data": {
    "cities":[{"id":3,"name":"杭州市"},{"id":289,"name":"上海市"}],
    "industries":[{"id":5,"name":"公建景观"},{"id":3,"name":"园林设计"}]
    "minPay":8000,
    "maxPay":12000,
    "isLongTerm": false// 是否驻场
  }
}
```

### 4.4.7 更新工作兴趣

|**URI**| user/updateWorkPrefs|
|:-:|:-:|
|**Method**| POST|
|**Role**| 2|

```
{
    "cities":[{"id":3,"name":"杭州市"},{"id":289,"name":"上海市"}],
    "industries":[{"id":5,"name":"公建景观"},{"id":3,"name":"园林设计"}]
    "minPay":8000,
    "maxPay":12000,
    "isLongTerm": false// 是否驻场
}
```
Return : no data

### 4.4.8 获取技能

 user/skills/
GET

```

   {"status":0,
   "msg":0,
   results:[{"id":1,"name":"CAD"},{"id":2,"name":"Photoshop"},
    {"id":3,"name":"园林设计"},{"id":4,"name":"环卫工程"},{"id":5,"name":"Maya"}]
    }
```


### 4.4.7 获取用户头像(TBD)

|**URI**| user/getUserFavicon/{userid}|
|:-:|:-:|
|**Method**| GET|
|**Role**| all|


### 4.4.8 上传用户头像(TBD)

|**URI**| user/updateUserFavicon|
|:-:|:-:|
|**Method**| POST|
|**Role**| all|


### 4.4.9 添加共同经历

发送站内消息 4.4.10 给设计师

|**URI**| user/applyCommonExp|
|:-:|:-:|
|**Method**| POST|
|**Role**| 2|

Request:

```
{
	"userid":12,
	"desc":"",
	"startDate":"yyyy-MM-dd",
	"endDate":"yyyy-MM-dd",
}
```

Response:

```
{
  "status": 0, // 0代表成功
  "msg": "", // 状态详情
}
```
### 4.4.10 接受添加共同经历

站内信:

```
{
	"msg":{
		"content":"{贾翕|user?id=12} 请求添加共同项目经历(2016-12-23~2016-12-26): 世纪公园一期"
	}
	"service":"user/acceptCommonExp",
	"postparams":{
		"messageid":11,
		"desc":"",
		"startDate":"yyyy-MM-dd",
		"endDate":"yyyy-MM-dd",
		"destuserid":11,
		"sourceuserid":12
	}
}
```

发送只读站内信给申请者：
```
{
	"msg":{
		"content":"{方璐|user?id=11} 接受了你的共同项目经历申请"
	}
}
```

### 4.4.11 上传个人作品 TBD



## 4.5 个人账户
### 4.5.1 获取我的账户余额
|**URI**| account/balance|
|:-:|:-:|
|**Method**| GET|
|**Role**| 2|

Response:

```
{
  "status": 0, // 0代表成功
  "msg": "", // 状态详情,
  "data":{
  		"balance": 135.00
  }
}
```

### 4.5.2 获取我的账户明细

|**URI**| account/transactions|
|:-:|:-:|
|**Method**| POST|
|**Role**| 2|

Request:

```
{
  "pageNo": 1, // 必填，从1开始
  "pageSize": 20, // 必填
  "order": "asc", 
  "orderBy": "transTime"
}
```


Response:


```
{
  "status": 0, // 0代表成功，其他状态码后续结合具体业务再定
  "msg": "", // 状态详情
  "data": {
    "pageNo": 1, // 必有
    "pageSize": 20, // 必有
    "order": "asc",
    "orderBy": "updateTime",
    "totalCount":100 // 必有
    "result":[{
    		"transTime":"2016-12-11,02:12:31",
    		"desc":"提现/项目#id #name 结算",
    		"amount": -12.00// 
    }]  
    }
  } 
}
```



### 4.5.3 申请提现


|**URI**| account/applyWithdrawl|
|:-:|:-:|
|**Method**| POST|
|**Role**| 2|

Request:

```
{
	"amount":100//提取额度,
	"alipayAccount": "illusion1125@gmail.com",
}
```

Response:

```
{
	"status":0,
	"message":""
}
```


发送 (4.5.4) 站内信给管理员


### 4.5.4 完成提现

站内信参数 给管理员

```
{
	"msg":{
		"content":"{贾翕|user?id=12} 请求提现 金额 500.00。"
	}
	"service":"account/withdraw",
	"postparams":{
		"messageid":11,
		"amount":500,
		"alipayAccount": "illusion1125@gmail.com",
		"userid":12
	}
}
```
发送只读站内信给申请者：
```
{
	"msg":{
		"content":"您的提现申请 500元 已经被处理成功。"
	}
}
```


## 4.6 项目列表
### 4.6.1 获取项目搜索列表
|**URI**| project/search|
|:-:|:-:|
|**Method**| POST|
|**Role**| all|
Request:

```json
{
    "keyword":"dsfd",
    "minPay":120,
    "maxPay":1000,
    "city":[{"id":2,"name":"SH"},{"id":3,"name":"BJ"},],
    "industry":[{"id":2,"name":"SH"},{"id":3,"name":"BJ"}],
    "pageNo":1,
    "pageSize":20
}

```
Response:

```json
{
  "status":0,
  "message":"获取成功",
  "data": {
    "pageNo": 1, 
    "pageSize": 20, 
    "totalCount":100, 
    "result":[{
          "id":13, 
          "name": "自由女神像",
          "manager":{"id":12,"username":"方璐","avatar":"/img/head.jpg"},
          "shortDesc":"自由女神像（英文：Statue Of Liberty），全名为“自由女神铜像国家纪念碑”，正式名称是“自由照耀世界（Liberty Enlightening the World）”，位于美国纽约海港内自由岛的哈德逊河口附近。是法国于1876年为纪念美国独立战争期间的美法联盟赠送给美国的礼物，1886年10月28日铜像落成",
          "status": 3,
          "startDate": "2016-1-1",
          "city":{"id":5,"name":"新乡"},
          "industry": {"id":5,"name":"公建景观"},
          "headcount":5,
          "hired":2,
          "image":"/img/Liberty.jpg"
    
        },{
          "id":12, 
          "name": "鸟巢 - 北京奥运会体育场",
          "shortDesc":"“鸟巢”是2008年北京奥运会主体育场。由2001年普利茨克奖获得者赫尔佐格、德梅隆与中国建筑师合作完成的巨型体育场设计，形态如同孕育生命的“巢”，它更像一个摇篮， 寄托着人类对未来的希望。设计者们对这个国家体育场没有做任何多余的处理，只是坦率地把结构暴露在外，因而自然形成了建筑的外观",
          "status": 1,
          "headcount":5,
          "hired":2,
          "startDate": "2015-12-21",
          "city":{"id":1,"name":"上海"},
          "industry": {"id":2,"name":"园林设计"},
          "image":"/img/p_123.jpg"
        }]  
  }
}
```
### 4.6.2 获取推荐项目列表(根据用户填写的偏好进行搜索推荐)
|**URI**| project/recommended|
|:-:|:-:|
|**Method**| POST|
|**Role**| all|
Request:

```
{
	"pageNo": 1, //required
 	"pageSize": 20, //required
}
```


Response:
和4.6.1 一致

### 4.6.3 获取最新项目列表(正在招募的项目时间倒序)
|**URI**| project/latest|
|:-:|:-:|
|**Method**| POST|
|**Role**| all|
Request:

```
{
  "pageNo": 1, //required
  "pageSize": 20, //required
}
```

Response:
和4.6.1 一致

## 4.7 设计师列表
### 4.7.1 设计师搜索
|**URI**| user/search|
|:-:|:-:|
|**Method**| POST|
|**Role**| all|
Request:

```json
{
	"pageNo": 1, //required
 	"pageSize": 20, 
  "minPay":8,
  "maxPay":1000,
  "city":[{"id":1,"name":2}],
  "industry":[{"id":1,"name":2}],
  "skill":[{"id":1,"name:3"}]
}
```
Response:

```json
{
	"status":0,
	"message":"",
	"data": {
		    "pageNo": 1, 
        "pageSize": 10, 
        "totalCount":20, 
        "result":[{
            "id":1,
            "name": "贾翕",
            "stauts":1,
            "city": {"id":1,"name":"上海"}, 
            "industry":[{"id":3,"name":"园林设计"},{"id":2,"name":"建筑设计"}],
            "avatar":"img/jesse.jpg"
        },{
            "id":2,
            "name": "方璐",
            "stauts":1,
            "city": {"id":1,"name":"上海"},
            "industry":[{"id":3,"name":"园林设计"},{"id":2,"name":"建筑设计"}],
            "avatar":"img/head.jpg"
        }]
	}
}
```

### 4.7.2 推荐设计师(根据项目经理手中进行项目的条件进行搜索匹配)
|**URI**| user/recommended|
|:-:|:-:|
|**Method**| POST|
|**Role**| 项目经理|

REQUEST:

```
{
  "pageNo": 1, // 必填，从1开始
  "pageSize": 20 // 必填
}
```

RESPONSE:

同4.7.1

### 4.7.3 热门设计师(按照评分倒序)

同4.7.1

## 4.8 项目管理

|项目状态|描述|前置条件|下一步行为|
|:-:|:-:|:-:|:-:|
|0|审核未通过|管理员审核未通过|管理员审核|
|1|审核中|项目创建表单提交或重新提交|管理员审核|
|2|招募中|管理员审核项目通过 或 上一阶段验收完成|项目经理人招募人员|
|3|已就绪|项目经理确认招募人员完成|项目经理启动项目|
|4|进行中|项目经理确认启动项目|项目收工|
|5|已完成|项目经理确认收工|无|
|6|已终止|管理员中断项目|无|


### 4.8.1 项目创建

project status: 0

|**URI**| project/new|
|:-:|:-:|
|**Method**| POST|
|**Role**| 3|
Request:

```json
{ 
  "skills": [{"id":3,"name":"dsf"},{"id":2,"name":"df"}], 
  "title": "项目名称", 
  "province": {"id":2,"name":""}, 
  "city": {"id":2,"name":""}, 
  "district": {"id":5,"name":""}, 
  "description": "sfdsfdssfjsdkfjdskjfkdsjfkdsjfksdjfkdjskfjsdkfjsfdsfdssfjsdkfjdskjfkdsjfkdsjfksdjfkdjskfjsdkfjsfdsfdssfjsdkfjdskjfkdsjfkdsjfksdjfkdjskfjsdkfj", 
  "image":"/images/project.png",
  "startDate": "2016-12-12", 
  "endDate": "2016-12-31", 
  "minPay": 81, 
  "maxPay": 1970, 
  "isLongTerm": true, 
  "industry": { "id": 1, "name": "建筑" },
  "industryAge": 10 
}

```
Response:

```json
{
  "status": 0, // 0代表成功
  "msg": "", // 状态详情
  "data": {
  		"id":1, //项目ID
  }
}

```


### 4.8.2 项目审核


accept: project status: 0,1->2, role: 4
reject: project status: 1->0, role: 4

|**URI**| project/accept|
|:-:|:-:|
|**Method**| POST|
|**Role**| 经纪人|

Request:

```json
{
	"id": 12, //
	"accpet": true //false to reject the project
}
```
Response:

```json
{
  "status": 0, // 0代表成功
  "msg": "", // 状态详情
 }

```

发送站内消息至项目创始人
```json
{"type":0,//0: 只读, 1:任务
"msg":"您的项目 {项目名称|project/12} 通过审核，经纪人为｛经纪人用户名|user/12}",
}
```

```json
{"type":0,//0: 只读, 1:任务
"msg":"您的项目 {项目名称|project/12} 未通过审核，请对项目进行修改并重新提交",
}
```


### 4.8.3 项目重新提交

|**URI**| project/resubmit|
|:-:|:-:|
|**Method**| POST|
|**Role**| 管理员|


Request:

```
{
  "id": 12
}
```
Response:

```
{
  "status": 0, // 0代表成功
  "msg": "", // 状态详情
 }

```


### 4.8.4 项目招人

|**URI**| project/hire|
|:-:|:-:|
|**Method**| POST|
|**Role**| 项目经理|

Request:

```json
{
  "id": 12,
  "userid":12
}
```

Response:

```json
{
  "status": 0, // 0代表成功
  "msg": "", // 状态详情
 }

```

发送站内消息至设计师
```
"type":1,//0: 只读, 1:任务
"msg":" {项目经理用户名|user/12} 希望应聘您为项目 {项目名称|project/12} 项目设计师,如已达成协议，请确认；如您和改项目不熟悉，请拒绝。",
"service":"project/acceptHiring",
"postparams":{
    "hireid":12//(id for the relationship between project and the designer)
}
```

### 4.8.5   设计师接受招募
|**URI**| project/acceptHiring|
|:-:|:-:|
|**Method**| POST|
|**Role**| 设计师|

Request:

```json
{
  "hireid": 12,
}
```

Response:

```json
{
  "status": 0, // 0代表成功
  "msg": "", // 状态详情
 }

```

发送站内消息至项目经理
```json
{
"type":0,//0: 只读, 1:任务
"msg":" 设计师{设计师|user/12} 接受了您在项目 {项目名称|project/12} 的招聘申请。"
}
```


### 4.8.6 项目经理确认招募完成

项目状态从招募中变成就绪中

|**URI**| project/completeHire|
|:-:|:-:|
|**Method**| POST|
|**Role**| 项目经理|

Request:

```json
{
  "id": 12,//项目ID
}
```

Response:

```json
{
  "status": 0, // 0代表成功
  "msg": "", // 状态详情
 }

```

### 4.8.7 项目经理启动项目

项目状态从就绪中变成进行中

|**URI**| project/start|
|:-:|:-:|
|**Method**| POST|
|**Role**| 项目经理|

Request:

```json
{
  "id": 12,//项目ID
}
```

Response:

```json
{
  "status": 0, // 0代表成功
  "msg": "", // 状态详情
 }

```



### 4.8.8 项目经理收尾项目

项目状态从进行中变成完成状态

|**URI**| project/end|
|:-:|:-:|
|**Method**| POST|
|**Role**| 项目经理|

Request:

```json
{
  "id": 12,//项目ID
}
```

Response:

```json
{
  "status": 0, // 0代表成功
  "msg": "", // 状态详情
 }

```

发送站内消息至参与人员进行评分
```
"type":2,//0: 只读, 1:任务, 2:回复  
"msg":"项目 {项目名称|project/12} 已完结，请给设计师 {设计师|id/1} 评分 "  项目设计师,如已达成协议，请确认；如您和改项目不熟悉，请拒绝。",
"service":"project/rate",
"postparams":{
    "id": 12,//项目ID
    "userid":1//被评人ID
    "rating":5 //默认5星??
},
"inputparams":{
    "rating": "integer"//需要用户输入的参数
}
```


### 4.8.9 项目经理对设计师评分,或设计师对项目经理评分

前置条件：项目状态为已完成

|**URI**| project/rate|
|:-:|:-:|
|**Method**| POST|
|**Role**| 项目经理|

Request:

```json
{
  "id": 12,//项目ID
  "userid":3, //设计师或经纪人
  "rating":3, //1-5
}
```

Response:

```json
{
  "status": 0, // 0代表成功
  "msg": "", // 状态详情
 }

```


### 4.8.10 管理员终止项目

|**URI**| project/terminate|
|:-:|:-:|
|**Method**| POST|
|**Role**| 管理员|

状态由任意阶段进入已终止


Request:

```json
{
	"id": 12, //项目ID
}
```
Response:

```json
{
  "status": 0, // 0代表成功
  "msg": "", // 状态详情
 }
```

### 4.8.11 项目修改（项目开始前可以对项目进行修改）

|**URI**| project/update/{projectid}|
|:-:|:-:|
|**Method**| POST|
|**Role**| 3|
Request:（以下参数第一层每个单独post）

```json
{
	"title":"项目名称",
	"province": {"id":2,"name":""}, 
  "city": {"id":2,"name":""}, 
  "district": {"id":5,"name":""}, 
  "description": "sfdsfdssfjsdkfjdskjfkdsjfkdsjfksdjfkdjskfjsdkfjsfdsfdssfjsdkfjdskjfkdsjfkdsjfksdjfkdjskfjsdkfjsfdsfdssfjsdkfjdskjfkdsjfkdsjfksdjfkdjskfjsdkfj", 
  "headcount":1,
  "image":"/images/project.png",
  "startDate": "2016-12-12", 
  "endDate": "2016-12-31", 
  "minPay": 81, 
  "maxPay": 1970, 
  "isLongTerm": true, 
  "industry": { "id": 1, "name": "建筑" },
  "industryAge": 10,
  "skills": [{"id":3,"name":"dsf"},{"id":2,"name":"df"}]
}
```

Response:

```json
{
  "status": 0, // 0代表成功
  "msg": "", // 状态详情
}

```

### 4.8.12 获取项目详情
|**URI**| project/details/{projectid}|
|:-:|:-:|
|**Method**| GET|
|**Role**| 3|

Response：

```json
{
  "status": 0, 
  "msg": "", 
  "data": {
    "id": 12, 
    "title": "鸟巢 - 北京奥运会体育场",
    "status":1,//项目状态
    "creationDate":"2016-01-21",
    "startDate":"2018-01-01",
    "endDate":"2018-12-31",
    "geo":{
      "province":{"id":1,"name":""},
      "city":{"id":1,"name":""},
      "district":{"id":1,"name":""},
    },
    "minPay":1200,
    "maxPay":2500,
    "industry":1,
    "headcount":2,
    "industryAge":12,
    "skills":[{"id":1,"name":""},{"id":3,"name":""},{"id":5,"name":""}],
    "manager":{"id":12,"username":"方璐","avatar":"/img/head.jpg","rating":-1},// -1表示未评分
    "designers":[{"id":12,"username":"方璐","avatar":"/img/head.jpg","rating":3}],
    "broker":{"id":12,"username":"方璐","avatar":"/img/head.jpg","rating":3},
    "desc":"“鸟巢”是2008年北京奥运会主体育场。由2001年普利茨克奖获得者赫尔佐格、德梅隆与中国建筑师合作完成的巨型体育场设计，形态如同孕育生命的“巢”，它更像一个摇篮， 寄托着人类对未来的希望。\n设计者们对这个国家体育场没有做任何多余的处理，只是坦率地把结构暴露在外，因而自然形成了建筑的外观",
    "image":"/img/p_123.jpg",
    "isLongTerm":true
  }
}
```



## 4.9 <del>阶段管理</del>
|阶段状态|描述|前置条件|下一步行为|
|:-:|:-:|:-:|:-:|
|0|阶段就绪中|阶段创建完成|阶段进入招募阶段|
|1|阶段招募中|管理员审核项目通过 或 上一阶段验收完成|项目经理人确认招募完毕|
|2|阶段进行中|项目经理确认完成当前阶段的招募|项目经理确认阶段完成|
|3|阶段验收中|项目经理确认当前阶段完成|经纪人验收|
|4|阶段完成|经纪人验收完成|下一阶段招募或项目收尾|

### 4.9.1 添加阶段

|**URI**| project/step/add|
|:-:|:-:|
|**Method**| POST|
|**Role**| 3|
Request:

```
{
	"name":"阶段名称",
	"projectid": 1
}
```
Response:

```
{
  "status": 0, // 0代表成功
  "msg": "", // 状态详情
  "data":{
  	  "id":1,//阶段ID
  }
 
}

```

### 4.9.2 修改阶段
|**URI**| project/step/update|
|:-:|:-:|
|**Method**| POST|
|**Role**| 3|
Request:

```
{
	"name":"阶段名称",
	"projectid": 1,
	"id":1
}
```
Response:

```
{
  "status": 0, // 0代表成功
  "msg": "", // 状态详情
  "data":{
  	  "id":1,//阶段ID
  }
 
}
```
### 4.9.3 删除阶段
|**URI**| project/step/delete|
|:-:|:-:|
|**Method**| POST|
|**Role**| 3|
Request:

```
{
  "projectid": 1, 
  "id": 1 
}
```
Response:

```
{
  "status": 0, // 0代表成功
  "msg": "" // 状态详情
}
```
### 4.9.4 获取项目阶段信息
|**URI**| project/step/getAll|
|:-:|:-:|
|**Method**| GET|
|**Role**| all|
Response:

```
{
  "status": 0, // 0代表成功
  "msg": "" // 状态详情,
  "data":[{
  		"stepid":1,
  		"status":1,//阶段状态
  		"name": "阶段名称",
 		"positions": [{//开放职位
 			"positionid":12,
 			"positionName":"园林设计师",
 			"positionType": 12,//ENUMS, TBD
 			"salary": 20000,
 			"headcount": 3
 		},...],
 		"hired":[{//已雇佣人
 			"hireid":12,
 			"userid":133,
 			"username":"贾翕",
 			"positionType": 12,
 			"positionName": 14,
 			"salary":13440
 		}]	
   },{
  }]
}
```


### 4.9.5 阶段招募完成

step status: 1->2, role: 3
project status : 2->3,

|**URI**| project/step/completeHiring|
|:-:|:-:|
|**Method**| POST|
|**Role**| 3|


Request:

```
{
	"projectid": 1,
	"id": 1
}
```
Response:

```
{
  "status": 0, // 0代表成功
  "msg": "" // 状态详情
}
```
删除职位信息



### 4.9.6 阶段收尾
step status: 2->3, role: 3
project status: 3->4

|**URI**| project/step/completeStep|
|:-:|:-:|
|**Method**| POST|
|**Role**| 3|
Request:

```
{
	"projectid": 1,
	"id": 1
}
```
Response:

```
{
  "status": 0, // 0代表成功
  "msg": "" // 状态详情
}
```

发送只读站内信给经纪人:

```
{
	"msg":{
		"content":"项目 {项目名称|project?id=3} 阶段二 已完成，申请验收。"
	}
}
```




### 4.9.7 阶段验收
step status: 3->4, role: 1
step status for next:  0->1
project status: 4->2 or 4->5

Reject:
step status 3->2

|**URI**| project/step/acceptCompletion|
|:-:|:-:|
|**Method**| POST|
|**Role**| 3|
Request:

```
{
	"projectid": 1,
	"id":1,
	"payments":[{//和设计师结算工资,TBD: 是否需要自动按照规定工资结算，即不需要提供以下信息
		"userid": 12,
		"payment": 2000
	},{
		"userid": 13,
		"payment": 2000
	}]
	"accept":true // false reject
}
```
Response:

```
{
  "status": 0, // 0代表成功
  "msg": "" // 状态详情
}
```


## 4.10 <del>招募管理</del>
### 4.10.1 添加招募职位
|**URI**| /project/step/addPosition|
|:-:|:-:|
|**Method**| POST|
|**Role**| 3|
Request:

```
{
	"projectid": 1,
	"stepid":1,
	"positionType":1,
	"salary": 2000,
	"headCount": 3
}
```
Response:

```
{
  "status": 0, // 0代表成功
  	"msg": "" // 状态详情,
  	data:{
  		"positionId":12,
  		"positionName":"园林设计师",
 		"positionType": 12,//ENUMS, TBD
 		"salary": 20000,
 		"headcount": 3
 	}
}
```
### 4.10.2 修改招募职位
|**URI**| /project/step/updatePosition|
|:-:|:-:|
|**Method**| POST|
|**Role**| 3|
Request:

```
{
	"positionid":1,
	"positionType":1,
	"salary": 2000,
	"headCount": 3
}
```
Response:

```
{
  "status": 0, // 0代表成功
  	"msg": "" // 状态详情,
  	data:{
  		"positionId":12,
  		"positionName":"园林设计师",
 		"positionType": 12,//ENUMS, TBD
 		"salary": 20000,
 		"headcount": 3
 	}
}
```

### 4.10.3 删除招募职位
|**URI**| /project/step/deletePosition|
|:-:|:-:|
|**Method**| POST|
|**Role**| 3|
Request:

```
{
	"positionid": 12
}
```
Response:

```
{
  "status": 0, // 0代表成功
  	"msg": "" // 状态详情
}
```

### 4.10.4 雇佣人员
|**URI**| /project/step/addEmployee|
|:-:|:-:|
|**Method**| POST|
|**Role**| 3|

Request:

```
{
	"projectid": 1,
	"stepid":1,
	"userid":15,
	"salary": 2000,
	"positionType": 12,//ENUMS, TBD
}
```
Response:

```
{
  "status": 0, // 0代表成功
  	"msg": "" // 状态详情,
  	data:{
 		"hireid":12,
 		"userid":133,
 		"username":"贾翕",
 		"positionType": 12,
 		"positionName": "园林设计师",
 		"salary":13440
 	}
}
```


### 4.10.5 申请解除合约
发送站内信给经纪人，由经纪人确认4.10.6
|**URI**| /project/step/applyRemoveHiring|
|:-:|:-:|
|**Method**| POST|
|**Role**| 3|
Request:

```
{
	"hireid": 12
}
```
Response:

```
{
  "status": 0, // 0代表成功
  	"msg": "" // 状态详情
}
```

发送 4.10.6 站内信：



### 4.10.6 同意解除合约

站内信:

```
{
	"msg":"{贾翕|user?id=12} 请求解除 {项目名称|project?id=12} 阶段二与 {方璐|user?id=11} 的合约",
	"service":"project/step//acceptRemoveHiring",
	"postparams":{
		"hireid":12
	}
}
```


### 4.10.7 推荐设计师


|**URI**|/project/step/recommendEmployee|
|:-:|:-:|
|**Method**| POST|
|**Role**| 1|

Request:

```
{
	"projectid": 1,
	"stepid":1,
	"userid":15
}
```

Response:

```
{
  "status": 0, // 0代表成功
  	"msg": "" // 状态详情
}
```

发送只读站内信给项目经理:

```
{
	"msg":{
		"content":"经纪人 {贾翕|user?id=1} 为您的项目 {项目经理|project?id=4} 阶段二 推荐 设计师  {方璐|user?id=1} 。"
	}
}
```


### 4.10.8 获取推荐设计师列表
|**URI**|/project/step/getRecommededEmployee/{stepid}|
|:-:|:-:|
|**Method**| GET|
|**Role**| 1|

Response:

```
{
  "status": 0, // 0代表成功
  	"msg": "" // 状态详情
  	"data":[{
		"id":1,//USER ID
		"name": "贾翕",//USER NAME
		"stauts":1,//USER STATUS
		"city": "上海",// 
		"industry":["园林设计","建筑设计"],
		"avatar":"img url" //用户头像

  	}]
}
```



## 4.11 系统消息
### 4.11.1 获取消息
|**URI**|/user/messages|
|:-:|:-:|
|**Method**| POST|
|**Role**| 1 2 3 4 |

站内信说明: 

系统消息分为两类，只读和任务
只读消息在用户点击完消息后，发送4.11.3 post 请求 标记已读
任务消息有两个按钮 接受和拒绝， 
任务消息数据里的service field指定了 接受/拒绝 点击后需要发送请求的service url,
postparams里存储里请求参数
点击后根据这两个字段组合成相应的post请求发给服务器



已读消息只保留最近10条


Request:

```json
{
  "pageNo": 1, // 必填，从1开始
  "pageSize": 20, // 必填
  "unprocessed":true//显示未处理消息或已处理消息
}
```


Response:

```json

{
	"status":"",
	"msg":"",
	"length":"",
	"data":{
		"pageNo": 1, // 必有
    	"pageSize": 20, // 必有
    	"order": "asc",
    	"orderBy": "sendTime",
    	"totalCount":2 // 必有,
    	"results":[{
			"status": 0,//0：未处理, 1:接受 2:拒绝,
      "readStatus":0,//0:未读, 1:已读
			"sendTime":"2015-12-12 12:01:21",
			"type":1,//0: 只读, 1:任务
			"msg":"{贾翕|user?id=12} 请求解除 {项目名称|project?id=12} 阶段二与 {方璐|user?id=11} 的合约",
			"service":"project/step//acceptRemoveHiring",
			"postparams":{
				"hireid":12
			},
      "inputparams":{
        "paramname":"type"
      }
		},{
			"status": 0//0:未处理 , 1: 已处理
			"sendTime":"2015-12-12 12:01:21",
			"type":0,//0: 只读
			"msg":"{贾翕|user?id=12} 请求解除 {项目名称|project?id=12} 阶段二与 {方璐|user?id=11} 的合约"
		
		}]
  }
}
```



### 4.11.2 消息操作 - 任务

|**URI**|/%service%|
|:-:|:-:|
|**Method**| POST|
|**Role**| 1 2 3 4|

Request

```json
{
	%params%,
	"accept":true//false reject:
	"messageid":12
}
```
### 4.11.3 消息操作 - 读或处理

|**URI**|/message/update/{id}|
|:-:|:-:|
|**Method**| POST|
|**Role**| 1 2 3 4|

Request

```json
{
	"readStatus":true,
  "status":0//0：未处理, 1:接受 2:拒绝 
}
```



## 4.12 用户安全信息
### 4.12.1 修改用户手机号


|**URI**|/user/modifyPhone/|
|:-:|:-:|
|**Method**| POST|
|**Role**| 1|

Request 2:

```
{
	"oldVerifyCode":"133387",//sendValidateCode拿的验证码
	"newPhone":"187129892",
	"newVerifyCode":"127292"
}I

```





### 4.12.2 修改密码
|**URI**|/user/modifyPassword/|
|:-:|:-:|
|**Method**| POST|
|**Role**| 1 2 3 4|

Request-Header(Authentication)

```
{
	"oldPasswd":"xxxxxxx",
	"newPasswd":"yyyyyyy"
}
```


## 4.13 元数据获取
### 4.13.1 城市搜索
|**URI**|/meta/city/search/:keyword|
|:-:|:-:|
|**Method**| GET|

```
{
   "status":0,
   "msg":"获取成功",
   "data":{
   	"results":[{
   	"id":201,
   	"name":"上海市"
   	},{
   	"id":202,
   	"name":"上饶市"
   	}]
   }
 
}
```
### 4.13.2 区列表
|**URI**|/meta/district/:cityid|
|:-:|:-:|
|**Method**| GET|

```
{
   "status":0,
   "msg":"获取成功",
   "data":{
   	"results":[{
   	"id":201,
   	"name":"杨浦区"
   	},{
   	"id":202,
   	"name":"浦东新区"
   	}]
   }
 
}
```

